#!/usr/bin/env bash

set -o pipefail
set -o nounset
set -o errexit

echo "Setting up git"
git config --global user.email $HEROKU_USER
git config --global user.name $HEROKU_USER_NAME

echo "Setting up Heroku .netrc"
cat <<EOF > $HOME/.netrc
machine api.heroku.com
  login $HEROKU_USER
  password $HEROKU_API_KEY
machine git.heroku.com
  login $HEROKU_USER
  password $HEROKU_API_KEY
EOF

echo "Starting code server"
/usr/local/bin/code-server \
  --host 0.0.0.0 \
  --port $PORT \
  --disable-telemetry \
  --disable-updates \
  --disable-ssh \
  --auth none \
  --user-data-dir $HOME \
  --extensions-dir $HOME \
  .
